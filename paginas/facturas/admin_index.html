<?php if(!isset($Ajax)){?><form action="admin/facturas/buscar/" method="post" name="myform" id="myform"><table align="right" style=" margin-right:50px"><tr><td><select name="mes">
 <option value="0" <?php if(!isset($Busqueda['mes'])){?>selected="selected" <?php }?>>Seleccione un mes</option>
  <option value="1"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==1) { ?> selected="selected"<?php }?>>Enero</option>
  <option value="2"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==2) { ?> selected="selected"<?php }?>>Febrero</option>
  <option value="3"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==3) { ?> selected="selected"<?php }?>>Marzo</option>
  <option value="4"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==4) { ?> selected="selected"<?php }?>>Abril</option>
  <option value="5"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==5) { ?> selected="selected"<?php }?>>Mayo</option>
  <option value="6"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==6) { ?> selected="selected"<?php }?>>Junio</option>
  <option value="7"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==7) { ?> selected="selected"<?php }?>>Julio</option>
  <option value="8"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==8) { ?> selected="selected"<?php }?>>Agosto</option>
  <option value="9"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==9) { ?> selected="selected"<?php }?>>Septiembre</option>
  <option value="10"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==10){  ?> selected="selected"<?php }?>>Octubre</option>
  <option value="11"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==11){  ?> selected="selected"<?php }?>>Noviembre</option>
  <option value="12"<?php if(isset($Busqueda['mes']) and $Busqueda['mes']==12){  ?> selected="selected"<?php }?>>Diciembre</option>
</select></td><td><select name="anio">
 <option value="0" selected="selected">Seleccione un Año</option>
  <option value="2015"<?php if(isset($Busqueda['anio']) and $Busqueda['anio']==2015){  ?> selected="selected"<?php }?>>2015</option>
  <option value="2016"<?php if(isset($Busqueda['anio']) and $Busqueda['anio']==2016){  ?> selected="selected"<?php }?>>2016</option>
  <option value="2017"<?php if(isset($Busqueda['anio']) and $Busqueda['anio']==2017){  ?> selected="selected"<?php }?>>2017</option>
  <option value="2018"<?php if(isset($Busqueda['anio']) and $Busqueda['anio']==2018){  ?> selected="selected"<?php }?>>2018</option>
</select></td><td> <select name="proveedor" id="proveedor" class="required" style="width:360px;">
                
				<option value="">Selecciona un proveedor</option>
				<?php foreach($Proveedores as $Cve => $Datos){
                	$kind=NULL;
                	if($Datos['fondo']==1) $kind="Fondo III";
                    else
                	if($Datos['fondo']==2) $kind="Obra Convenida";
                    else
                	if($Datos['fondo']==3) $kind="Gasto Corriente";
                    else
                	if($Datos['fondo']==4) $kind="Aporte federal";
                    else
                	if($Datos['fondo']==5) $kind="Otras Aportaciones";
                    if(isset($Busqueda['proveedor']) and $Busqueda['proveedor']==$Datos['id'])
                    
                    
					echo "<option value='{$Datos['id']}' selected='selected'>{$Datos['nombre']}--{$kind}</option>";
                    else
                    
					echo "<option value='{$Datos['id']}'>{$Datos['nombre']}--{$kind}</option>";
				} ?>
			</select></td><td><input type="button" value="pagar"  style="border:none; background-image:url(plantillas/admin/images/pago.png);  color:transparent; background-repeat:no-repeat; background-color:transparent; width:40px; height:40px"  id="pagar"/></td><td>
    
				<input type="hidden" name="action" id="action" value="buscar" />
					
          </td><td><select name="estatus" id="estatus">                     
                      <option value="0">Seleccione Estatus</option>
                    <?php  if(isset($Busqueda['estatus']) and $Busqueda['estatus']==1) 
                    {
                   			?> <option value="1" selected="selected">Se debe</option><?php 
                   	}else 
                    { ?>
                   		<option value="1">Se debe</option><?php 
                    }?>
                	<?php  if(isset($Busqueda['estatus']) and $Busqueda['estatus']==2) 
                	{
                   		?> <option value="2" selected="selected">Pagada</option><?php 
                    }else 
                    {?>
                   		<option value="2">Pagada</option><?php 
                        
                    }
                    
                    ?>
                    </select><?php //if(isset($Busqueda['like']))print_r($Busqueda['like']);
                    $ch=0;
                     if(isset($Busqueda['like']['cantidad'][0]) and $Busqueda['like']['cantidad'][0]<>"") {$ch=1;
                     		$value=$Busqueda['like']['cantidad'][0];}
                     else 
                     if(isset($Busqueda['like']['numero'][0]) and $Busqueda['like']['numero'][0]<>"") {$ch=2;
                     		$value=$Busqueda['like']['numero'][0];}
                     else  
                     if(isset($Busqueda['like']['descripcion'][0]) and $Busqueda['like']['descripcion'][0]<>"") {$ch=3;
                    	$value=$Busqueda['like']['descripcion'][0];}
                     else
                     $value="";
                     if(isset($Busqueda['fondo']) and $Busqueda['fondo']>0)
                     
                    ?></td></tr><tr><td><select name="fondo" id="fondo">
                       
                      <option value="0" <?php if(!isset($Busqueda['fondo']) or $Busqueda['fondo']==0){?>selected="selected"<?php }?>>Seleccione tipo de fondo</option>
                      <option value="1" <?php if(isset($Busqueda['fondo']) and $Busqueda['fondo']==1){?>selected="selected"<?php }?>>Fondo III</option>
                      <option value="2" <?php if(isset($Busqueda['fondo']) and $Busqueda['fondo']==2){?>selected="selected"<?php }?>>Obra Convenida</option>
                      <option value="3" <?php if(isset($Busqueda['fondo']) and $Busqueda['fondo']==3){?>selected="selected"<?php }?>>Gasto Corriente</option>
                      <option value="4" <?php if(isset($Busqueda['fondo']) and $Busqueda['fondo']==4){?>selected="selected"<?php }?>>Aporte Federal</option>                      
                      <option value="5" <?php if(isset($Busqueda['fondo']) and $Busqueda['fondo']==5){?>selected="selected"<?php }?>>Otras Aportaciones</option>
                    </select></td><td><input type="text" name="buscar" id="buscar" class="required" placeholder="Busqueda" value="<?php echo $value;?>"/></td><td>
                      <label>
                        <input name="campo" type="radio" id="campo_1" value="1"  <?php  if($ch==1 or $ch==0){?>checked="checked" <?php }?> />
                Cantidad</label>
                      <label>
                        <input type="radio" name="campo" value="2" id="campo_1" <?php  if($ch==2){?>checked="checked" <?php }?>  />
                        # factura</label>
                      <label>
                        <input type="radio" name="campo" value="3" id="campo_1" <?php  if($ch==3){?>checked="checked" <?php }?>  />
                        Descripción</label>
						<input type="submit" value="Buscar" id="btnSubmit" /><input type="submit" value="pdf" name="btnSubmit2" id="btnSubmit2"  style="border:none; background-image:url(plantillas/admin/images/pdficon.jpg); color:transparent; background-repeat:no-repeat; background-color:transparent; width:19px; height:19px"/></td></tr></table>
      </p>
    </form><div style="height:1px;  clear:both;;"></div><article class="module width_full">
	<header>
	<h3 class="tabs_involved">Lista de Facturas</h3>
	<ul class="tabs">
		<li class="active"><a href="#listado">Listado</a></li>
		<li><a href="#agregar">Agregar</a></li>
	</ul>
	</header>
	<div class="tab_container">
      
  <div id="listado" class="tab_content">
			<table class="tablesorter" cellspacing="0"> 
				<thead> 
					<tr>
						<th>Numero Factura</th> 
						<th>Monto</th>
                        
						<th>Proveedor</th>
						<th>Descripción</th>
						<th></th>					
					</tr> 
				</thead> 
				<tbody>
				<?php $a=$b=1; foreach ($Facturas as $cve => $dato): ?>
					<tr class="p<?php echo  isset($Maximo)?$a:1; if($Maximo['rows']==$b){$a++;$b=0;}$b++;?>">
						<td><?php echo $dato['numero'];?></td> 
						<td>$<?php echo number_format($dato['cantidad'],2);?></td>
						<td><?php echo $dato['nombre'];?></td>
						<td><?php echo $dato['descripcion'];?></td>
						<td>
							<?php 
								echo $this->Html->Link("javascript:;",$this->Html->img("../images/icn_edit.png",array("title"=>"Editar Enlace")),array("id"=>"btnEditar","style"=>"margin:0px 5px;","prefijo"=>false,"proveedor"=>$dato['proveedor'],"numero"=>$dato['numero'],"cantidad"=>$dato['cantidad'],"estatus"=>$dato['estatus'],"fecha1"=>$dato['fecha1'],"idfactura"=>$dato['id'], "fecha1"=>$dato['fecha1'], "fecha2"=>$dato['fecha2'], "cheque"=>$dato['cheque'],"suma"=>$dato['suma'], "descripcion"=>$dato['descripcion']));
								echo $this->Html->Link("facturas/borrar/".$dato['id'],$this->Html->img("../images/icn_trash.png",array("title"=>"Eliminar Facturas")),array("class"=>"Eliminar"));
							?>
						</td> 
					</tr> 
				<?php endforeach;?>
				</tbody> 
			</table>
			<footer style="text-align:right;">
				<p style="margin-right:25px;">Pagina <span id="page">1</span> de <?php echo isset($Maximo) && $Maximo['total']>0?ceil($Maximo['total']/$Maximo['rows']):1; echo $this->Html->img("../images/flechaIzq.png",array("title"=>"Página Anterior","style"=>"width:10px;cursor:pointer","id"=>"ant"));echo "&nbsp;";  echo $this->Html->img("../images/flechaDer.png",array("title"=>"Página Siguiente","style"=>"width:10px;cursor:pointer","id"=>"next"));   ?></p>
			</footer>
		</div>
		<div id="agregar" class="tab_content">
			<form id="ProcesarEstado" method="POST" action="admin/facturas/agregar/">
				<input type="hidden" name="action" id="action" value="agregar" />
				<input type="hidden" name="id" id="id" value="" /><fieldset>	<label for="proveedor" >Proveedor:</label><br/>
                <select name="proveedor" id="proveedor" class="required">
                
				<option value="">Selecciona un proveedor</option>
				<?php foreach($Proveedores as $Cve => $Datos){
                	$kind=NULL;
                	if($Datos['fondo']==1) $kind="Fondo III";
                    else
                	if($Datos['fondo']==2) $kind="Obra Convenida";
                    else
                	if($Datos['fondo']==3) $kind="Gasto Corriente";
                    else
                	if($Datos['fondo']==4) $kind="Aporte federal";
                    else
                	if($Datos['fondo']==5) $kind="Otras Aportaciones";
                    
					echo "<option value='{$Datos['id']}'>{$Datos['nombre']}--{$kind}</option>";
				} ?>
			</select>
				
					<label for="rfc" >Numero de factura:</label><br/>
					
					<input type="text" name="numero" id="numero" class="required" placeholder="Numero de Factura"/><br/><br/>
					<label for="cantidad">Importe:</label><br/>
					<input type="text" name="cantidad" id="cantidad" class="required" placeholder="Cantidad"/>
                    <label for="suma">Suma:</label><br/>
					<input type="text" name="suma" id="suma" class="required" placeholder="Suma"/>
					<label for="estatus">Estatus:</label><select name="estatus" id="estatus">                      
                      <option value="1">Se debe</option>
                      <option value="2">Pagada</option>
                    </select>
					<label for="fecha1">Fecha emisión:</label><br/>
					<input type="text" name="fecha1" id="fecha1" class="required" placeholder="Fecha Emision"/>
                    
					<label for="fecha2">Fecha en que se pago:</label><br/>
					<input type="text" name="fecha2" id="fecha2" class="required" placeholder="fecha2"/>
					<label for="cheqe">Cheque:</label><br/>
					<input type="text" name="cheque" id="cheque" class="required" placeholder="Cheque"/>
					<label for="descripcion">Descripcion:</label><br/>
					<input type="text" name="descripcion" id="descripcion" class="required" placeholder="Descripcion"/>
					
				</fieldset>
				<footer>
					<div class="submit_link">
						<input type="submit" value="Guardar" id="btnSubmit" />
					</div>
				</footer>
			</form>
		</div>
	</div><!-- end of .tab_container -->
</article><!-- end of content manager article -->
<script type="text/javascript">
 $("#pagar").live("click",function() {

    $('#myform').attr('action', 'admin/facturas/pagar'); 
	
 $('#myform').submit();
  });

$(function() {
		$( "#fecha1" ).datepicker({
			defaultDate: "+1w",
			changeMonth: true,
			numberOfMonths: 3,dateFormat: 'yy-mm-dd',
			onClose: function( selectedDate ) {
				$( "#to" ).datepicker( "option", "minDate", selectedDate );
			}
		});
		$( "#fecha2" ).datepicker({
			defaultDate: "+1w",
			changeMonth: true,
			numberOfMonths: 3,dateFormat: 'yy-mm-dd',
			onClose: function( selectedDate ) {
				$( "#from" ).datepicker( "option", "maxDate", selectedDate );
			}
		});
	});

var a=2;
var b=null;
<?php $a=2;while($a<=ceil($Maximo['total']/$Maximo['rows'])){?>
$(".p<?php echo $a;?>").hide();<?php $a++;}?>
$("img#next").live("click",function(){ 	if(a>1)b=a-1;if(b>=1 && a<=<?php echo ceil($Maximo['total']/$Maximo['rows']);?>) {
	$('.p'+b).hide();
	$('.p'+a).show();
	
		$("span#page").html(a);
	if(a<<?php echo ceil($Maximo['total']/$Maximo['rows']);?>)
	a++;
	
	}});
	
	$("img#ant").live("click",function(){ 	if(a>1)b=a-1;if(a>1) {
	$('.p'+b).show();
	
		$("span#page").html(b);
	$('.p'+a).hide();
	if(a>2)
	a--;
	}});
	
	$("#btnEditar").live("click",function(){		
		
		
		$("select#proveedor option[value='"+$(this).attr("proveedor")+"']").attr("selected","selected");
		$("select#estatus option[value='"+$(this).attr("estatus")+"']").attr("selected","selected");
		
		$("input#numero").val($(this).attr("numero"));
		
		$("input#cantidad").val($(this).attr("cantidad"));
		$("input#suma").val($(this).attr("suma"));
		$("input#id").val($(this).attr("idfactura"));
		$("input#action").val("editar");
		
		
		$("input#fecha1").val($(this).attr("fecha1"));	
		$("input#fecha2").val($(this).attr("fecha2"));
		$("input#cheque").val($(this).attr("cheque"));
		$("input#descripcion").val($(this).attr("descripcion"));
		
		$("ul.tabs li").removeClass("active");
		$("ul.tabs").append('<li class="active"><a href="javascript:;">Editar</a></li>');
		$(".tab_content").hide();
		$("#agregar").fadeIn();
	});
</script>
<?php }
else
{
	//define('FPDF_FONTPATH',NULL);
    require('fpdf.php');
    class PDF extends FPDF
{

// Tabla simple
function BasicTable( $data,$prov)
{ //print_r($data);
    // Cabecera
 
        $this->Cell(20,7,"FECHA",1);
         $this->Cell(20,7,"FACTURA",1);
          $this->Cell(70,7,"PROVEEDOR",1);
           $this->Cell(90,7,"CONCEPTO",1);
            $this->Cell(20,7,"PAGOS",1);
             $this->Cell(20,7,"IMPORTE",1);
             
             $this->Cell(20,7,"SALDO",1);
    $this->Ln();
    // Datos
    $suma=0;
    foreach($data as $row=>$dat)
    {
    
            $can=ceil(strlen(utf8_decode($dat['descripcion']))/40)*6;
            if($can==0)$can=6;
            $this->Cell(20,$can,$dat['fecha1'],1);
            
            $this->Cell(20,$can,$dat['numero'],1);
            //foreach($prov as $Cve => $Datos){if($dat['proveedor']==$Datos['id'])
            $this->Cell(70,$can,utf8_decode($dat['nombre']),1);//}
            $this->MultiCell(90,6,utf8_decode(strtoupper($dat['descripcion'])),1);
     $this->SetY($this->GetY()-$can);
     $this->SetX(210);
            $this->Cell(20,$can,"$".number_format($dat['suma'],2),1);
            
            $this->Cell(20,$can,"$".number_format($dat['cantidad'],2),1);
               $this->Cell(20,$can,"$".number_format($dat['cantidad']-$dat['suma'],2),1);
               $suma+=$dat['cantidad']-$dat['suma'];
        $this->Ln();
    }
    
    $this->Cell(260,10,'Total deuda $'.number_format($suma,2),0,1,'R');  
}}
    $pdf = new PDF('L','mm','A4');
    $pdf->AddPage();$var='';
            if(isset($Busqueda['mes']) and $Busqueda['mes']>0) {
            	if($Busqueda['mes']==1)$mes='ENERO';if($Busqueda['mes']==2)$mes='FEBRERO';if($Busqueda['mes']==3)$mes='MARZO';
                if($Busqueda['mes']==4)$mes='ABRIL';if($Busqueda['mes']==5)$mes='MAYO';if($Busqueda['mes']==6)$mes='JUNIO';
                if($Busqueda['mes']==7)$mes='JULIO';if($Busqueda['mes']==8)$mes='AGOSTO';if($Busqueda['mes']==9)$mes='SEPTIEMBRE';
                if($Busqueda['mes']==10)$mes='OCTUBRE';if($Busqueda['mes']==11)$mes='NOVIEMBRE';if($Busqueda['mes']==12)$mes='DICIEMBRE';
                if(isset($Busqueda['anio']) and $Busqueda['anio']>0)$anio=$Busqueda['anio'];else $anio=date("Y");
                
                
                $var.='AL MES DE '.$mes.' DEL AÑO '.$anio;}
                else
                {
                    	if(isset($Busqueda['anio']) and $Busqueda['anio']>0){$anio=$Busqueda['anio'];
                    		$var.=' DEL AÑO '.$anio;
                    }
                }
                if(isset($Busqueda['estatus']) and $Busqueda['estatus']==1)
                $var.=' PENDIENTES DE PAGO ';
                if(isset($Busqueda['estatus']) and $Busqueda['estatus']==2)
                $var.=' PAGADAS ';
                  if(isset($Busqueda['proveedor']) and $Busqueda['proveedor']>0)
                 foreach($Proveedores as $Cve => $Datos){if($Busqueda['proveedor']==$Datos['id'])$var.=" DEL PROVEEDOR ".strtoupper(($Datos['nombre']));}
               
                 if(isset($Busqueda['like']['cantidad'][0]) and $Busqueda['like']['cantidad'][0]<>"")
                 	$var.=' CON EL CRITERIO DE BUSQUEDA IMPORTE '.strtoupper($Busqueda['like']['cantidad'][0]);
                 if(isset($Busqueda['like']['numero'][0]) and $Busqueda['like']['numero'][0]<>"")
                 	$var.=' CON EL CRITERIO DE BUSQUEDA # FACTURA '.strtoupper($Busqueda['like']['numero'][0]);
                 if(isset($Busqueda['like']['descripcion'][0]) and $Busqueda['like']['descripcion'][0]<>"")
                 	$var.=' CON EL CRITERIO DE BUSQUEDA DESCRIPCION "'.strtoupper($Busqueda['like']['descripcion'][0]).'"';
                 if(isset($Busqueda['fondo']) and $Busqueda['fondo']>0){
                 	if($Busqueda['fondo']==1) $var.=" FONDO III";
                 	if($Busqueda['fondo']==2) $var.=" OBRA CONVENIDA";
                 	if($Busqueda['fondo']==3) $var.=" GASTO CORRIENTE";
                 	if($Busqueda['fondo']==4) $var.=" APORTE FEDERAL";
                 	if($Busqueda['fondo']==5) $var.=" OTRAS APORTACIONES";
                 }
                    
	$title = 'Reporte de Facturas';
	$pdf->SetTitle($title);
    //$pdf->AddFont('Helvetica','','helveticas.php');
    
    $pdf->SetFont('Arial','',10);
    $pdf->Cell(270,10,utf8_decode('MUNICIPIO DE HUETAMO MICHOACÁN'),0,1,'C');     
    $pdf->MultiCell(270,5,utf8_decode('FACTURAS CORRESPONDIENTES '.$var),0,'C');
    

$pdf->BasicTable($Facturas,$Proveedores);
    $pdf->Output();
}
?>